<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running Operations for Vectors • runner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Running Operations for Vectors">
<meta property="og:description" content="Calculates running functions  with varying window size and missing handling options. 
  Package brings also running streak and running which, what extends beyond range of functions 
  already implemented in R packages. Calculating on windows depending on date also available.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">runner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/running_window_functions_in_r.html">Running window functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="runner-a-r-package-for-running-operations-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#runner-a-r-package-for-running-operations-" class="anchor"></a><code>runner</code> a R package for running operations.</h1></div>
</div>
<div id="section" class="section level1">
<h1 class="hasAnchor">
<a href="#section" class="anchor"></a><img src="articles/images/hexlogo.png" align="right">
</h1>
<p><a href="https://CRAN.R-project.org/package=runner"><img src="https://cranlogs.r-pkg.org/badges/runner" alt="Cran badge"></a> <a href="https://travis-ci.org/gogonzo/runner"><img src="https://travis-ci.org/gogonzo/runner.svg?branch=master" alt="Travis-CI Build Status"></a> <a href="https://ci.appveyor.com/project/gogonzo/runner"><img src="https://ci.appveyor.com/api/projects/status/github/gogonzo/runner?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a> <img src="https://codecov.io/gh/gogonzo/runner/branch/master/graph/badge.svg" alt="Coverage status"></p>
<div id="about" class="section level2">
<h2 class="hasAnchor">
<a href="#about" class="anchor"></a>About</h2>
<p>Package contains standard running functions (aka. windowed, rolling, cumulative) with additional options. <code>runner</code> provides extended functionality like date windows, handling missings and varying window size. <code>runner</code> brings also rolling streak and rollin which, what extends beyond range of functions already implemented in R packages.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Install package from from github or from CRAN.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># devtools::install_github("gogonzo/runner")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"runner"</span>)</a></code></pre></div>
</div>
<div id="using-runner" class="section level2">
<h2 class="hasAnchor">
<a href="#using-runner" class="anchor"></a>Using runner</h2>
<p>The main idea of the package is to provide running operations on R vectors. Running functions are these which are applied to all elements up to actual one. For example implemented already in <code>base</code> <code>cumsum</code>, <code>cummin</code> etc. Functions provided in this package works similar but with extended functionality such as handling <code>NA</code>, custom window size. The most functions provided in package are based on the same logic:</p>
<p><img src="articles/images/runner_api.png"></p>
<div id="fixed-window-size" class="section level3">
<h3 class="hasAnchor">
<a href="#fixed-window-size" class="anchor"></a>fixed window size</h3>
<p><code>k</code> denotes number of elements in window. For fixed window size <code>k</code> should be single value.</p>
<p><img src="articles/images/options_window_size.png"></p>
</div>
<div id="varying-window-size" class="section level3">
<h3 class="hasAnchor">
<a href="#varying-window-size" class="anchor"></a>Varying window size</h3>
<p>For varying window size <code>k</code> should be of the same length as <code>x</code>. Varying window size means that for element <code>[i]</code> function will be calculated on window of length <code>k[i]</code>.</p>
<p><img src="articles/images/options_window_size_varying.png"></p>
</div>
<div id="windows-depending-on-date" class="section level3">
<h3 class="hasAnchor">
<a href="#windows-depending-on-date" class="anchor"></a>Windows depending on date</h3>
<p>Sometimes data points in dataset are not equally spaced (missing weeekends, holidays, other missings) and thus window size should vary to keep expected time frame. If one specifies <code>idx</code> argument, than running functions are applied on windows depending on date. <code>idx</code> should be the same length as <code>x</code> of class <code>Date</code> or <code>integer</code>. Including <code>idx</code> can be combined with varying window size, than k will denote number of periods in window different for each data point.</p>
<p><img src="articles/images/options_idx.png"></p>
</div>
<div id="other-options" class="section level3">
<h3 class="hasAnchor">
<a href="#other-options" class="anchor"></a>Other options</h3>
<ul>
<li>
<code>na_rm = TRUE</code> handling missing and is equivalent to <code>na.rm</code>.</li>
</ul>
<p><img src="articles/images/options_na_rm.png"></p>
<ul>
<li>
<code>na_pad=T</code> if window size exceeds number of available elements, than first <code>k-1</code> elements are filled with <code>NA</code>.</li>
</ul>
<p><img src="articles/images/options_na_pad.png"></p>
<ul>
<li>
<code>which</code> used with running index, which value (‘first’ or ‘last’)</li>
</ul>
<p><img src="articles/images/options_which_first_last.png"></p>
</div>
<div id="running-aggregations-meansumminmax_run" class="section level3">
<h3 class="hasAnchor">
<a href="#running-aggregations-meansumminmax_run" class="anchor"></a>Running aggregations <code>(mean|sum|min|max)_run</code>
</h3>
<p>Runner provides basic aggregation methods calculated within running windows. Below example showing some functions behavior for different arguments setup. Let’s take a look at 8th element of a vector on which <code>min_run</code> is calculated. First setup uses default values, so algorithm is looking for minimum value in all elements before actual (i=8). By default missing values are removed before calculations by argument <code>na_rm=TRUE</code>, and also window is not specified. The default is equivalent of <code><a href="https://rdrr.io/r/base/cumsum.html">base::cummin</a></code> with additional option to ignore <code>NA</code> values. In second example within window k=5, the lowest value is -3. In the last example minimum is not available due to existence of <code>NA</code>. Graphical example is reproduced below in the code.</p>
<p><img src="articles/images/running_minimum.png" alt="running minimum"></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(runner)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">5</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">3</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="ot">NA</span>,<span class="op">-</span><span class="dv">2</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">k &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">idx &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>,<span class="dv">13</span>,<span class="dv">16</span>,<span class="dv">19</span>,<span class="dv">21</span>,<span class="dv">23</span>,<span class="dv">26</span>)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">a0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cumsum.html">cummin</a></span>(x)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">a1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/min_run.html">min_run</a></span>(x, <span class="dt">na_rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">a2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/min_run.html">min_run</a></span>(x, <span class="dt">k=</span><span class="dv">5</span>, <span class="dt">na_rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">a3 &lt;-<span class="st"> </span><span class="kw"><a href="reference/min_run.html">min_run</a></span>(x, <span class="dt">na_rm =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">a4 &lt;-<span class="st"> </span><span class="kw"><a href="reference/min_run.html">min_run</a></span>(x, <span class="dt">k=</span>k, <span class="dt">na_rm =</span> <span class="ot">TRUE</span>, <span class="dt">na_pad =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">a5 &lt;-<span class="st"> </span><span class="kw"><a href="reference/min_run.html">min_run</a></span>(x, <span class="dt">k=</span><span class="dv">5</span>, <span class="dt">idx=</span>idx)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(idx, x, a0, a1, a2, a3, a4, a5)</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt;    idx  x a0 a1 a2 a3 a4  a5</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; 1    1  1  1  1  1  1 NA   1</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; 2    3 -5 -5 -5 -5 -5 NA  -5</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; 3    4  1 -5 -5 -5 -5 NA  -5</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; 4    6 -3 -5 -5 -5 -5 -5  -5</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; 5    7 NA NA -5 -5 NA -5  -5</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; 6   10 NA NA -5 -5 NA -3  -3</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; 7   13 NA NA -5 -3 NA NA Inf</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt; 8   16  1 NA -5 -3 NA  1   1</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">#&gt; 9   19 -1 NA -5 -1 NA -1  -1</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">#&gt; 10  21 NA NA -5 -1 NA -1  -1</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="co">#&gt; 11  23 -2 NA -5 -2 NA -2  -2</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co">#&gt; 12  26  3 NA -5 -2 NA  3  -2</span></a></code></pre></div>
</div>
<div id="fill_run" class="section level3">
<h3 class="hasAnchor">
<a href="#fill_run" class="anchor"></a>fill_run</h3>
<p>Function used to replace <code>NA</code> with previous non-NA element. To understand how <code>fill_run</code> works, take a look on illustration. Row ‘x’ represents, and another rows represent replaced <code>NA</code> by fill_run with different options setup (run_for_first=TRUE and only_within=TRUE respectively). By default, <code>fill_run</code> replaces all <code>NA</code> if they were preceded by any value. If <code>NA</code> appeared in the beginning of the vector then it would not be replaced. But if user specify <code>run_for_first=TRUE</code> initial empty values values will be replaced by next non-empty value. Option <code>only_within=TRUE</code> means that <code>NA</code> values would be replaced if they were surrounded by pair of identical values. No windows provided in this functionality.</p>
<p><img src="articles/images/fill_run.png" alt="fill run"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"b"</span>,<span class="st">"b"</span>,<span class="st">"a"</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="ot">NA</span>,<span class="st">"a"</span>,<span class="st">"b"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(x, </a>
<a class="sourceLine" id="cb3-3" data-line-number="3">           <span class="dt">f1 =</span> <span class="kw"><a href="reference/fill_run.html">fill_run</a></span>(x), </a>
<a class="sourceLine" id="cb3-4" data-line-number="4">           <span class="dt">f2 =</span> <span class="kw"><a href="reference/fill_run.html">fill_run</a></span>(x,<span class="dt">run_for_first =</span> T), </a>
<a class="sourceLine" id="cb3-5" data-line-number="5">           <span class="dt">f3 =</span> <span class="kw"><a href="reference/fill_run.html">fill_run</a></span>(x, <span class="dt">only_within =</span> T))</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;       x   f1 f2   f3</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; 1  &lt;NA&gt; &lt;NA&gt;  b &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; 2  &lt;NA&gt; &lt;NA&gt;  b &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; 3     b    b  b    b</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; 4     b    b  b    b</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; 5     a    a  a    a</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; 6  &lt;NA&gt;    a  a    a</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; 7  &lt;NA&gt;    a  a    a</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; 8     a    a  a    a</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; 9     b    b  b    b</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; 10 &lt;NA&gt;    b  b &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt; 11    a    a  a    a</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; 12    b    b  b    b</span></a></code></pre></div>
</div>
<div id="running-streak" class="section level3">
<h3 class="hasAnchor">
<a href="#running-streak" class="anchor"></a>Running streak</h3>
<p>To count consecutive elements in specified window one can use <code>streak_run</code>. Following figure illustrates how streak is calculated with three different options setup for 9th element of the input vector <code>x</code>. First shows default configuration, with full window and <code>na_rm=T</code>. Second example count within k=4 window with count reset on <code>NA</code>. Last example counting streak with continuation after <code>NA</code>. Visualization also supported with corresponding R code.</p>
<p><img src="articles/images/running_streaks.png" alt="fill run"></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="ot">NA</span>,<span class="st">"B"</span>,<span class="st">"A"</span>,<span class="st">"B"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  x, </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">s0 =</span> <span class="kw"><a href="reference/streak_run.html">streak_run</a></span>(x),</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="dt">s1 =</span> <span class="kw"><a href="reference/streak_run.html">streak_run</a></span>(x, <span class="dt">na_rm=</span>F, <span class="dt">k=</span><span class="dv">3</span>),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  <span class="dt">s2 =</span> <span class="kw"><a href="reference/streak_run.html">streak_run</a></span>(x, <span class="dt">k=</span><span class="dv">4</span>) )</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;       x s0 s1 s2</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; 1     A  1  1  1</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 2     B  1  1  1</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; 3     A  1  1  1</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 4     A  2  2  2</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; 5     B  1  1  1</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; 6     B  2  2  2</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; 7     B  3  3  3</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; 8  &lt;NA&gt;  3 NA  3</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; 9     B  4  1  3</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; 10    A  1  1  1</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; 11    B  1  1  1</span></a></code></pre></div>
</div>
<div id="running-which" class="section level3">
<h3 class="hasAnchor">
<a href="#running-which" class="anchor"></a>Running which</h3>
<p>To obtain index number of element satisfying some condition in window, one can use running which. Functions from this group returns index while condition is <code>TRUE</code> appeared before n-th element of a vector. In below example <code>whicht_run</code> function returns index of element containing <code>TRUE</code> value. If <code>na_rm=T</code> is specified, missing is treated as <code>FALSE</code>, and is ignored while searching for <code>TRUE</code>. While user set <code>na_rm=F</code> like in second example, function returns <code>NA</code>, because in following window <code>TRUE</code> appears after missing and it’s impossible to be certain which is first (missing is an element of unknown value - could be TRUE or FALSE).</p>
<p><img src="articles/images/running_which_more.png" alt="whicht run"></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(T,T,T,F,<span class="ot">NA</span>,T,F,<span class="ot">NA</span>,T,F,T,F)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  x, </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="dt">s0 =</span> <span class="kw">whicht_run</span>(x, <span class="dt">which=</span><span class="st">"first"</span>),</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="dt">s1 =</span> <span class="kw">whicht_run</span>(x, <span class="dt">na_rm=</span>F, <span class="dt">k=</span><span class="dv">5</span>, <span class="dt">which=</span><span class="st">"first"</span>),</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  <span class="dt">s2 =</span> <span class="kw">whicht_run</span>(x, <span class="dt">k=</span><span class="dv">5</span>,<span class="st">"first"</span>))</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;        x s0 s1 s2</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; 1   TRUE  1  1  1</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; 2   TRUE  1  1  1</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; 3   TRUE  1  1  1</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; 4  FALSE  1  1  1</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; 5     NA  1  1  1</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; 6   TRUE  1  2  2</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; 7  FALSE  1  3  3</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; 8     NA  1 NA  6</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; 9   TRUE  1 NA  6</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; 10 FALSE  1  6  6</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; 11  TRUE  1 NA  9</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt; 12 FALSE  1 NA  9</span></a></code></pre></div>
</div>
<div id="unique-elements-in-window" class="section level3">
<h3 class="hasAnchor">
<a href="#unique-elements-in-window" class="anchor"></a>Unique elements in window</h3>
<p>User can use <code>unique_run</code> create list of unique elements within specified window size.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">x2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>( letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">6</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">x2 </a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; [1] "b" "b" "c" "b" "a" "c"</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw">unique_run</span>( <span class="dt">x=</span>x2, <span class="dt">k =</span> <span class="dv">3</span> )</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; [1] "b"</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; [1] "b"</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; [1] "b" "c"</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; [1] "b" "c"</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt; [1] "b" "a" "c"</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt; [[6]]</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt; [1] "b" "a" "c"</span></a></code></pre></div>
</div>
</div>
<div id="apply-custom-function" class="section level2">
<h2 class="hasAnchor">
<a href="#apply-custom-function" class="anchor"></a>Apply custom function</h2>
<div id="own-runner" class="section level3">
<h3 class="hasAnchor">
<a href="#own-runner" class="anchor"></a>Own runner</h3>
<p>One can use own function with function <code>runner</code> which will be applied in the same way as other build-in functions.</p>
<p><img src="articles/images/custom_runner.png"></p>
<p>Below example of using <code><a href="https://rdrr.io/r/base/mean.html">base::mean</a></code> inside of the <code>runner</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">15</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">k &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>, <span class="dv">15</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">idx &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="dv">15</span>, <span class="dt">replace=</span>T))</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># simple call</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">simple_mean &lt;-<span class="st"> </span><span class="kw"><a href="reference/runner.html">runner</a></span>(<span class="dt">x =</span> x, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">f =</span> mean)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co"># additional arguments for mean</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">trimmed_mean &lt;-<span class="st"> </span><span class="kw"><a href="reference/runner.html">runner</a></span>(<span class="dt">x =</span> x, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">f =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(x, <span class="dt">trim =</span> <span class="fl">0.05</span>))</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co"># varying window size</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">varying_window &lt;-<span class="st"> </span><span class="kw"><a href="reference/runner.html">runner</a></span>(<span class="dt">x =</span> x, <span class="dt">k =</span> k, <span class="dt">f =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(x, <span class="dt">trim =</span> <span class="fl">0.05</span>))</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co"># date windows</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">date_windows &lt;-<span class="st"> </span><span class="kw"><a href="reference/runner.html">runner</a></span>(<span class="dt">x =</span> x, <span class="dt">k =</span> k, <span class="dt">idx =</span> idx, <span class="dt">f =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(x, <span class="dt">trim =</span> <span class="fl">0.05</span>))</a>
<a class="sourceLine" id="cb7-16" data-line-number="16"></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(x, k, idx, simple_mean, trimmed_mean, varying_window, date_windows)</a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt;             x  k idx simple_mean trimmed_mean varying_window date_windows</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; 1  0.38583502  3   2   0.3858350    0.3858350      0.3858350   0.38583502</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; 2  0.07752929  2   5   0.2316822    0.2316822      0.2316822   0.07752929</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt; 3  0.57656265 11   7   0.3466423    0.3466423      0.3466423   0.34664232</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt; 4  0.33857956  3   9   0.3446266    0.3446266      0.3308905   0.45757111</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; 5  0.64316990  4  10   0.4089604    0.4089604      0.4089604   0.51943737</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; 6  0.57206304 15  14   0.5325938    0.5325938      0.4322899   0.43228991</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; 7  0.97284027 10  18   0.6316632    0.6316632      0.5095114   0.63166319</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt; 8  0.44270686  8  19   0.6576950    0.6576950      0.5011608   0.66253673</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt; 9  0.69699375  8  21   0.6711510    0.6711510      0.5400557   0.67115098</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; 10 0.15635949 13  24   0.5672251    0.5672251      0.4862640   0.56819268</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; 11 0.06388711  5  28   0.3399868    0.3399868      0.4665575   0.11012330</span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30"><span class="co">#&gt; 12 0.15208290  8  31   0.2673308    0.2673308      0.4625129   0.12410983</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31"><span class="co">#&gt; 13 0.45374364 11  34   0.2065183    0.2065183      0.4608172   0.20651828</span></a>
<a class="sourceLine" id="cb7-32" data-line-number="32"><span class="co">#&gt; 14 0.25401691  1  36   0.2309326    0.2309326      0.2540169   0.25401691</span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33"><span class="co">#&gt; 15 0.06179891 11  38   0.2304106    0.2304106      0.4063330   0.19710589</span></a></code></pre></div>
</div>
<div id="creating-windows" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-windows" class="anchor"></a>Creating windows</h3>
<p>Function creates list of windows. Because <code>runner</code> provide limited functionality, one can create running-window-list which can be further processed by user to obtain desired statistic (eg. window sum). <code>x</code> is a vector to be ‘run on’ and <code>k</code> is a length of window. In this example window length is varying as specified by <code>k</code>. Provide one value to obtain constant window size.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw"><a href="reference/window_run.html">window_run</a></span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">k =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>) )</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; [1] 1 2</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; [1] 1 2 3</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; [1] 2 3 4</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; [1] 4 5</span></a></code></pre></div>
<p>Such windows can be used in further calculations, with any R function. Example below shows how to obtain running <code>sum</code> in specified, varying window length (specified by <code>k</code>).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="reference/window_run.html">window_run</a></span>( <span class="dt">x=</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">k =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(sum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span>unlist</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; [1] 1 3 6 9 9</span></a></code></pre></div>
<p>One can also specify window based on a date of other numeric index. To do this date should be passed via <code>idx</code> argument and k should be integer denoting date-window span.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="reference/window_run.html">window_run</a></span>( <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">k =</span> <span class="dv">3</span>, <span class="dt">idx =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>) ) </a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; [1] 1 2</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; [1] 3 4</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; [1] 3 4 5</span></a></code></pre></div>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=runner">https://​cloud.r-project.org/​package=runner</a>
</li>
<li>Report a bug at <br><a href="https://github.com/gogonzo/runner/issues">https://​github.com/​gogonzo/​runner/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Dawid Kałędkowski <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Dawid Kałędkowski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
